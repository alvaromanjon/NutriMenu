\apendice{Especificación de diseño}

\section{Introducción}

Este apartado provee un estudio que permite entender mejor cómo se integran todas las piezas que conforman el proyecto. En los siguientes puntos se va a proceder a analizar cómo se ha planteado el modelo de datos, se van a explorar las distintas rutas que existen para interactuar con los datos y cómo se llevan a cabo, y se va a analizar la arquitectura de todos los servicios, con el objetivo de que leyendo esta sección se sea capaz de tener una idea bastante acertada de cómo se comporta y comunica la aplicación.

\section{Diseño de datos}

En esta sección se va a presentar el modelo de datos usado en la aplicación (figura \ref{fig:DB/nutrimenu_data_schema}), y se van a describir las distintas relaciones entre las entidades que lo forman:

\begin{itemize}
	\item \textbf{Empresa}: Contiene toda la información referente a las empresas registradas en la aplicación. Esta entidad puede estar relacionada con uno o varios locales, menús, platos y usuarios.
	\item \textbf{Usuario}: Dispone de toda la información referente a los usuarios, como su información de acceso y una enumeración que indica el rol al que pertenecen. Los roles a tomar pueden ser:
	\begin{itemize}
		\item \textbf{Administrador}: Permite el acceso al panel de administración, que se encarga de la gestión de empresas, locales, usuarios y alimentos. No pertenecen a ninguna empresa.
		\item \textbf{Editor}: Son miembros de una empresa, y se permite el acceso al panel de editores, que se encarga de la gestión de menús y platos.
		\item \textbf{Camarero}: Son miembros de una empresa, y se permite el acceso al panel de camareros, que se encarga de la gestión de menús.
	\end{itemize}
	Los usuarios con roles de Editor o Camarero van a tener una relación varios a uno con una empresa (realmente los administradores también, solo que el valor de id de empresa va a ser nulo).
	\item \textbf{Local}: Esta entidad contiene toda al información relacionada con los locales. Los locales sólo puede pertenecer a una empresa, debido a su relación varios a uno. Además, existe una relación de varios a varios con los menús.
	\item \textbf{Menú}: Es la entidad que contiene toda la información relacionada con los menús. Está directamente relacionada con las empresas, ya que varios menús pueden pertenecer a una sola empresa. Además existe una relación de varios a varios con los locales, y otra de este mismo tipo con los platos.
	\item \textbf{Plato}: Esta entidad dispone de toda la información referente a los platos, y dispone de una enumeración que indica qué tipo de plato es cada objeto de tipo Plato. Tiene una relación de varios a uno con una empresa, y además de esto tiene dos relaciones varios a varios: una correspondiente a los menús, y otra a los alimentos.
	\item \textbf{Alimento}: Es la entidad que almacena la información básica de los alimentos, como el grupo de alimento al que pertenece, los gramos por ración que representan los componentes nutricionales, y su nombre y descripción. Esta entidad tiene una relación de varios a varios con los platos, y además tiene una relación uno a uno con los componentes nutricionales, ya que cada alimento dispone de una instancia de componentes.
	\item \textbf{Componentes nutricionales}: Esta entidad contiene toda la información relevante a los componentes nutricionales de un alimento. Tiene dos relaciones uno a uno, una con vitaminas y otra con minerales, ya que estas 3 entidades juntas forman el junto de información referente a un alimento. También forma parte de una relación uno a varios con la entidad Plato \textunderscore Alimento, puesto que es la entidad intermedia que contiene información adicional sobre la relación varios a varios entre Plato y Alimento.
	\item \textbf{Vitaminas}: Es la instancia que contiene toda la información sobre las vitaminas de un alimento, y tiene una relación uno a uno con componentes nutricionales.
	\item \textbf{Minerales}: Es la instancia que contiene toda la información sobre los minerales de un alimento, y tiene una relación uno a uno con componentes nutricionales.
	\item \textbf{Plato\textunderscore Alimento}: Esta relación es la que permite que varios platos puedan pertenecer a varios alimentos, y viceversa. Esta entidad intermedia existe para almacenar los gramos por ración escogidos para un alimento en un plato, y calcular y almacenar los valores de los componentes nutricionales proporcionales a esa cantidad.
	\item \textbf{Menu\textunderscore Local}: Esta relación es la que permite que varios locales puedan pertenecer a varios menús, y viceversa. Esto es esencial para que no haga falta crear menús duplicados por cada local, y que estos puedan ser reutilizados tantas veces como sea necesario.
	\item \textbf{Menu\textunderscore Plato}: Esta relación es la que permite que varios menús puedan pertenecer a varios platos, y viceversa. Esto permite que un plato pueda estar en varios menús, y no tengan que existir entidades duplicadas.
\end{itemize}

\imagen{DB/nutrimenu_data_schema}{Diagrama relacional del modelo de datos}{1}


\section{Diseño procedimental}

\subsection{Diagramas de secuencia}

A continuación se van a presentar las interacciones entre el usuario, la aplicación web y la API REST mediante el uso de diagramas de secuencia, ya que esto va a permitir entender mejor el flujo de ejecución de las distintas tareas que se pueden ejecutar en la aplicación.

\imagen{diagramas_secuencia/inicio_sesion}{Diagrama de inicio de sesión}{1}

\imagen{diagramas_secuencia/contraseña_olvidada}{Diagrama del proceso de contraseña olvidada}{1}

\imagen{diagramas_secuencia/creacion_nuevo_elemento}{Diagrama de creación de una empresa o alimento a mano}{1}

\imagen{diagramas_secuencia/creacion_nuevo_elemento_empresas}{Diagrama de creación de un local o usuario}{1}

\imagen{diagramas_secuencia/creacion_alimento_nutritionix}{Diagrama de creación de un alimento con Nutritionix}{1}

\imagen{diagramas_secuencia/creacion_plato}{Diagrama de creación de un plato}{1}

\imagen{diagramas_secuencia/creacion_menu}{Diagrama de creación de un menú}{1}

\imagen{diagramas_secuencia/edicion_elemento}{Diagrama de edición de un elemento}{1}

\imagen{diagramas_secuencia/borrado_elemento}{Diagrama de borrado de un elemento}{1}


\subsection{Diseño de la API REST}

Uno de los grandes cambios que se han realizado en este proyecto respecto a la iteración anterior es el desarrollo de una API REST completa para trabajar e interactuar con los datos. Esta API nos permite abstraernos de la base de datos, ya que todas las operaciones CRUD en la aplicación se van a realizar atacando directamente a esta.

A continuación se van a detallar y documentar cada uno de los \textit{endpoints} disponibles, para poder trabajar con ellos cómodamente y entender mejor las posibilidades que ofrecen.

\newpage

\begin{table}[htp]
\begin{apiRoute}{get}{/empresas}{Devuelve todas las empresas existentes}
	
	\begin{routeParameter}
		\routeParamItem{id\_empresa}{Devuelve la empresa con el ID correspondiente}
		\routeParamItem{nombre}{Devuelve todas las empresas cuyo nombre contengan el valor pasado por parámetro}
		\routeParamItem{cif}{Devuelve la empresa con el CIF correspondiente}
	\end{routeParameter}
	
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
	"id": 13,
	"nombre": "Universidad de Burgos",
	"email": "contacto@ubu.es",
	"direccion": "Calle Don Juan de Austria, 1 ",
	"ciudad": "Burgos",
	"codigoPostal": 9001,
	"telefono": "947129482",
	"cif": "15544225C"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/empresas"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
	
\end{apiRoute}
\caption{Endpoint que devuelve empresas existentes}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{post}{/empresas}{Añade una nueva empresa}
	\begin{routeParameter}
		\noRouteParameter{No hay parámetros}
	\end{routeParameter}
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Vips",
	"email": "empresa@vips.com",
	"direccion": "Puerta del Sol, Madrid",
	"telefono": "900123123",
	"cif": "123456787"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
	"id": 3,
	"nombre": "Vips",
	"email": "empresa@vips.com",
	"direccion": "Puerta del Sol, Madrid",
	"telefono": "900123123",
	"cif": "123456787"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite añadir una empresa}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{put}{/empresas}{Actualiza la información de una empresa ya existente}
	\begin{routeParameter}
		\routeParamItem{id\_empresa}{Modifica cualquier valor de la empresa con el ID correspondiente}
	\end{routeParameter}
	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "UBU"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
	"id": 13,
	"nombre": "Universidad de Burgos",
	"email": "contacto@ubu.es",
	"direccion": "Calle Don Juan de Austria, 1 ",
	"ciudad": "Burgos",
	"codigoPostal": 9001,
	"telefono": "947129482",
	"cif": "15544225C"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/empresas"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite actualizar la información de una empresa}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{delete}{/empresas}{Elimina una empresa de la base de datos}
	\begin{routeParameter}
		\routeParamItem{id\_empresa}{Elimina la empresa con el ID correspondiente}
	\end{routeParameter}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
Empresa con id eliminada correctamente	
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/empresas"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite borrar una empresa}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{get}{/usuarios}{Devuelve todos los usuarios existentes}
	
	\begin{routeParameter}
		\routeParamItem{id\_usuario}{Devuelve el usuario con el ID correspondiente}
		\routeParamItem{id\_empresa}{Devuelve todos los usuarios de la empresa con el ID correspondiente}
		\routeParamItem{usuario}{Devuelve el usuario cuyo nombre de usuario sea el pasado por parámetro}
		\routeParamItem{email}{Devuelve el usuario cuyo email sea el pasado por parámetro}
		\routeParamItem{rol}{Devuelve todos los usuarios con un rol determinado}
	\end{routeParameter}
	
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
[
    {
        "id": 1,
        "usuario": "camarero",
        "password": "test",
        "nombre": "Administrador",
        "email": "camarero@gmail.com",
        "rol": "CAMARERO",
        "empresa": 
        	{...},
        }
]
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un usuario con id 3",
    "path": "/usuarios"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
	
\end{apiRoute}
\caption{Endpoint que devuelve usuarios existentes}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{post}{/usuarios}{Añade un nuevo usuario}
	\begin{routeParameter}
		\routeParamItem{id\_empresa}{ID de la empresa a la que va a pertenecer el usuario (en caso de que su rol lo indique)}
	\end{routeParameter}
	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
    "usuario": "administrador",
    "password": "admin123",
    "nombre": "Administrador",
    "email": "administrador@gmail.com",
    "rol": "ADMINISTRADOR"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 2,
    "usuario": "administrador",
    "password": "admin123",
    "nombre": "Administrador",
    "email": "administrador@gmail.com",
    "rol": "ADMINISTRADOR",
    "empresa": null
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/usuarios"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite añadir un usuario}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{post}{/login}{Comprueba un inicio de sesión}	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
    "usuario": "administrador",
    "password": "admin123"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 2,
    "usuario": "administrador",
    "password": "admin123",
    "nombre": "Administrador",
    "email": "administrador@gmail.com",
    "rol": "ADMINISTRADOR",
    "empresa": null
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un usuario con id 3",
    "path": "/usuarios"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{401}{Bad Request: PasswordNotCorrectException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": La contrasena para el ... es incorrecta",
    "path": "/usuarios"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite comprobar un inicio de sesión}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{put}{/usuarios}{Actualiza la información de un usuario ya existente}
	\begin{routeParameter}
		\routeParamItem{id\_usuario}{Modifica cualquier valor del usuario con el ID correspondiente}
	\end{routeParameter}
	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Juan Sanchez"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 2,
    "usuario": "administrador",
    "password": "admin123",
    "nombre": "Juan Sanchez",
    "email": "administrador@gmail.com",
    "rol": "ADMINISTRADOR",
    "empresa": null
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un usuario con id 3",
    "path": "/usuarios"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite actualizar la información de un usuario}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{delete}{/usuarios}{Elimina un usuario de la base de datos}
	\begin{routeParameter}
		\routeParamItem{id\_usuario}{Elimina el usuario con el ID correspondiente}
	\end{routeParameter}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
Usuario con id eliminado correctamente	
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un usuario con id 3",
    "path": "/usuarios"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite borrar un usuario}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{get}{/locales}{Devuelve todos los locales existentes}
	
	\begin{routeParameter}
		\routeParamItem{id\_local}{Devuelve el local con el ID correspondiente}
		\routeParamItem{id\_empresa}{Devuelve todos los locales correspondientes a la empresa con el ID correspondiente}
		\routeParamItem{nombre}{Devuelve todos los locales cuyo nombre contengan el valor pasado por parámetro}
		\routeParamItem{email}{Devuelve el local con el email correspondiente}
		\routeParamItem{telefono}{Devuelve el local con el teléfono correspondiente}
	\end{routeParameter}
	
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
	"id": 1,
	"nombre": "Escuela Politecnica",
	"email": "eps@ubu.es",
	"direccion": "Avenida Cantabria",
	"telefono": "947123123",
	"empresa": {
		"id": 1,
		...
        }
    }
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/locales"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
	
\end{apiRoute}
\caption{Endpoint que devuelve locales existentes}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{post}{/locales}{Añade un nuevo local}
	\begin{routeParameter}
		\routeParamItem{id\_empresa}{Indica a qué empresa pertenece el local}
	\end{routeParameter}
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Cafeteria EPS",
	"email": "eps@ubu.es",
	"direccion": "Avenida Cantabria",
	"telefono": "947123954"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 3,
    "nombre": "Cafeteria EPS",
    "email": "eps@ubu.es",
    "direccion": "Avenida Cantabria",
    "telefono": "947123954",
    "empresa": {
        "id": 1,
        ...
    }
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/locales"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite añadir un local}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{put}{/locales}{Actualiza la información de un local ya existente}
	\begin{routeParameter}
		\routeParamItem{id\_local}{Modifica cualquier valor del local con el ID correspondiente}
	\end{routeParameter}
	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Cafeteria Economicas"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 3,
    "nombre": "Cafeteria Economicas",
    "email": "eps@ubu.es",
    "direccion": "Avenida Cantabria",
    "telefono": "947123954",
    "empresa": {
        "id": 1,
        ...
    }
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un local con id 3",
    "path": "/locales"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite actualizar la información de un local}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{delete}{/locales}{Elimina un local de la base de datos}
	\begin{routeParameter}
		\routeParamItem{id\_local}{Elimina el local con el ID correspondiente}
	\end{routeParameter}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
Local con id eliminado correctamente	
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un local con id 3",
    "path": "/locales"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite eliminar un local}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{get}{/menus}{Devuelve todos los menús existentes}
	
	\begin{routeParameter}
		\routeParamItem{id\_menu}{Devuelve el menú con el ID correspondiente}
		\routeParamItem{id\_local}{Devuelve todos los menús del local con el ID correspondiente}
		\routeParamItem{id\_empresa}{Devuelve todos los menús de la empresa con el ID correspondiente}
	\end{routeParameter}
	
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
	"id": 1,
	"nombre": "Menu del martes",
	"descripcion": "Menu del martes",
	"fechaCreacion": "2023-09-19",
	"fechaPublicacion": "2023-09-19",
	"locales": [
		...
	],
	"platos": [
		...
	]
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un menu con id 3",
    "path": "/menus"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: LackOfParametersException}
			\begin{routeResponseItemBody}
No se ha especificado ningun parametro de busqueda
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
	
\end{apiRoute}
\caption{Endpoint que devuelve menús existentes}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{post}{/menus}{Añade un nuevo menú}
	\begin{routeParameter}
		\routeParamItem{id\_empresa}{Indica a qué empresa pertenece el menú}
	\end{routeParameter}
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Menu del martes",
	"descripcion": "Menu del martes",
	"fechaPublicacion": "2023-09-19",
	"platos": [
		{
			"id": 3
		}
	],
	"locales": [
		{
			"id": 3
		}
	]
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
	"id": 1,
	"nombre": "Menu del martes",
	...
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/menus"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite añadir menús}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{put}{/menus}{Actualiza la información de un menú ya existente}
	\begin{routeParameter}
		\routeParamItem{id\_menu}{Modifica cualquier valor del menú con el ID correspondiente}
	\end{routeParameter}
	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Menu del miercoles"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
	"id": 1,
	"nombre": "Menu del miercoles",
	"descripcion": "Menu del martes",
	"fechaCreacion": "2023-09-19",
	"fechaPublicacion": "2023-09-19",
	"locales": [
		...
	],
	"platos": [
		...
	]
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un menu con id 3",
    "path": "/menus"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite actualizar la información de un menú}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{delete}{/menus}{Elimina un menú de la base de datos}
	\begin{routeParameter}
		\routeParamItem{id\_menu}{Elimina el menú con el ID correspondiente}
	\end{routeParameter}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
Menu con id eliminado correctamente	
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un menu con id 3",
    "path": "/menus"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite eliminar un menú}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{get}{/platos}{Devuelve todos los platos existentes}
	
	\begin{routeParameter}
		\routeParamItem{id\_plato}{Devuelve el plato con el ID correspondiente}
		\routeParamItem{id\_empresa}{Devuelve todos los platos de la empresa con el ID correspondiente}
		\routeParamItem{tipo\_plato}{Devuelve todos los platos de un tipo determinado en una empresa (para poder realizar esta búsqueda es necesario pasar id\_empresa también)}
	\end{routeParameter}
	
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
[
    {
        "id": 1,
        "tipoPlato": "PRIMER_PLATO",
        "nombre": "Kevin Bacon",
        "descripcion": "Hamburguesa rellena de bacon",
        "fechaCreacion": "2023-09-19",
        "fechaModificacion": "2023-09-19",
        "alimentos": [
        	...
        ]
    }
]
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un plato con id 3",
    "path": "/platos"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: LackOfParametersException}
			\begin{routeResponseItemBody}
No se ha especificado ningun parametro de busqueda
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
	
\end{apiRoute}
\caption{Endpoint que devuelve platos existentes}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{post}{/platos}{Añade un nuevo plato}
	\begin{routeParameter}
		\routeParamItem{id\_empresa}{Indica a qué empresa pertenece el plato}
	\end{routeParameter}
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
    "nombre": "Paella",
    "descripcion": "Paella valenciana",
    "tipoPlato": "PRIMER_PLATO",
    "alimentos": [
    	{
    		"id": 2,
    		"cantidad": 150
    	}
    ]
    
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 4,
    ...
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe una empresa con id 3",
    "path": "/platos"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite la creación de un plato}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{put}{/platos}{Actualiza la información de un plato ya existente}
	\begin{routeParameter}
		\routeParamItem{id\_plato}{Modifica cualquier valor del plato con el ID correspondiente}
	\end{routeParameter}
	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Paella valenciana"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 4,
    "tipoPlato": "PRIMER_PLATO",
    "nombre": "Paella valenciana",
    ...
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un plato con id 3",
    "path": "/platos"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite modificar un plato}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{delete}{/platos}{Elimina un plato de la base de datos}
	\begin{routeParameter}
		\routeParamItem{id\_plato}{Elimina el plato con el ID correspondiente}
	\end{routeParameter}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
Plato con id eliminado correctamente	
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un plato con id 3",
    "path": "/platos"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite borrar un plato}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{get}{/alimentos}{Devuelve todos los alimentos existentes}
	
	\begin{routeParameter}
		\routeParamItem{id\_alimento}{Devuelve el alimento con el ID correspondiente}
		\routeParamItem{nombre}{Devuelve todos los alimentos que contienen ese nombre}
		\routeParamItem{tipo\_alimento}{Devuelve todos los alimentos de un tipo determinado}
	\end{routeParameter}
	
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
[
    {
        "id": 1,
        "nombre": "Tequenos",
        "grupoAlimento": "CEREALES",
        "gramosPorRacion": 125.0,
        "componentesNutricionales": {
        	...
        }
    },
    ...
]
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un alimento con id 3",
    "path": "/alimentos"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
	
\end{apiRoute}
\caption{Endpoint que devuelve alimentos existentes}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{post}{/alimentos}{Añade un nuevo alimento}
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
    "nombre": "Arroz",
    "grupoAlimento": "CEREALES",
    "gramosPorRacion": 125,
    "componentesNutricionales": {
    	...
    }
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 2,
    "nombre": "Arroz",
    "grupoAlimento": "CEREALES",
    "gramosPorRacion": 125.0,
    "componentesNutricionales": {
    	...
    }
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite añadir un alimento}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{put}{/alimentos}{Actualiza la información de un alimento ya existente}
	\begin{routeParameter}
		\routeParamItem{id\_alimento}{Modifica cualquier valor del alimento con el ID correspondiente}
	\end{routeParameter}
	
	\begin{routeRequest}{application/json}
		\begin{routeRequestBody}
{
	"nombre": "Teques"
}
		\end{routeRequestBody}
	\end{routeRequest}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
{
    "id": 1,
    "nombre": "Teques",
    "grupoAlimento": "CEREALES",
    "gramosPorRacion": 125.0,
    "componentesNutricionales": {
    	...
    }
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un alimento con id 3",
    "path": "/alimentos"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite actualizar la información de un alimento}
\end{table} \afterpage{\clearpage}

\begin{table}[htp]
\begin{apiRoute}{delete}{/alimentos}{Elimina un alimento de la base de datos}
	\begin{routeParameter}
		\routeParamItem{id\_alimento}{Elimina el alimento con el ID correspondiente}
	\end{routeParameter}
	\begin{routeResponse}{application/json}
		\begin{routeResponseItem}{200}{ok}
			\begin{routeResponseItemBody}
Alimento con id eliminado correctamente	
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\begin{routeResponseItem}{400}{Bad Request: EntityDoesntExistsException}
			\begin{routeResponseItemBody}
{
    "timestamp": "2023-09-19T17:18:27.228+00:00",
    "status": 400,
    "error": "Bad Request",
    "trace": "ooo.alvar.nutrimenu.apirest.excepciones...",
    "message": "No existe un alimento con id 3",
    "path": "/alimentos"
}
			\end{routeResponseItemBody}
		\end{routeResponseItem}
		
	\end{routeResponse}
\end{apiRoute}
\caption{Endpoint que permite eliminar un alimento}
\end{table} \afterpage{\clearpage}

\section{Diseño arquitectónico}


En esta sección se va a analizar cómo está construida la aplicación desde una perspectiva estructural y de alto nivel. Para ello, se van a analizar los distintos patrones de diseño aplicados, así como la estructura de la infraestructura planteada. 

\subsection{Backend}

Para el desarrollo del backend se ha aplicado el patrón Modelo-Vista-Controlador, como ya se ha descrito en la memoria. A continuación se van a desarrollar las distintas capas que conforman cada entidad en Spring Boot (figura \ref{fig:SpringBoot/architecture_model}), con el fin de entender cómo se traduce el patrón MVC a este modelo:

\begin{itemize}
\item \textbf{Modelo}: Corresponde a la definición como tal de cada entidad, es decir, la estructura de datos por la que está compuesta y sus relaciones con otras entidades. Los modelos se van a mapear a las tablas de la base de datos a través del uso de JPA y anotaciones.

\item \textbf{Repositorio}: Esta capa permite abstraer la lógica de acceso a datos. 

Para crear un repositorio, se define una interfaz que extiende \textit{CrudRepository}, otra interfaz que ofrece métodos ya predefinidos de acceso a datos, para evitar tener que escribir consultas SQL explícitas. En esta interfaz se van a indicar los métodos que van a ser necesarios para acceder a la base de datos.

 En caso de que algún método requiera de una operación no contenida en \textit{CrudRepository}, también se pueden indicar las \textit{queries} SQL de forma explícita mediante el uso de JPQL.
 
\item \textbf{Servicio}: Esta es la capa que contiene la lógica de negocio de la aplicación. 

Se encuentra entre la capa de repositorio y la de controlador, puesto que va a ser la encargada de realizar las operaciones complejas de gestión de datos mediante el uso de los repositorios, para luego proveer estos métodos al controlador. 

\item \textbf{Controlador}: La capa de controlador es la encargada de definir, gestionar y proveer de una forma de acceso a los datos, que en nuestro caso son los \textit{endpoints} de la API. 

Esta capa interactúa con los distintos métodos que provee la capa de servicio para que cada endpoint realice las operaciones correspondientes, y sea capaz de presentar los datos adecuados.
\end{itemize}

\imagen{SpringBoot/architecture_model}{Arquitectura de un proyecto Spring Boot \cite{researchgate:spring-boot-architecture}}{1}

\subsection{Frontend}

Para el desarrollo del frontend, las distintas piezas que conforman la aplicación se han implementado siguiendo distintos patrones:

\begin{itemize}
	\item \textbf{Patrón Contenedor/Presentacional}: Este patrón se encarga de dividir la lógica de negocio y el estado de la aplicación de la presentación de los datos (figura \ref{fig:React/container_presentation_pattern}), lo cual favorece a separar responsabilidades y hacer un código más reusable y mantenible. 

	Esta es una estrategia que se ha seguido bastante a lo largo del desarrollo de la aplicación, especialmente en las partes encargadas de crear elementos. 
	
	Un componente padre (\textbf{Contenedor}) se encarga del manejo de los datos, mientras que los componentes hijos (\textbf{Presentacionales}) son los encargados de presentar la interfaz al usuario.
	
	\imagen{React/container_presentation_pattern}{Diagrama del patrón Contenedor/Presentacional en React}{0.8}
	
	\item \textbf{Patrón Proveedor}: El patrón Proveedor se usa en React para pasar datos a lo largo del árbol de componentes sin tener que hacerlo de forma explícita, ya que se acabaría produciendo lo que se denomina como \textit{perforación de accesorios} (figura \ref{fig:React/accessory_perforation}), que es el enviar props de un elemento de alto nivel a otro de muy bajo nivel, pasando este prop por todos los elementos intermedios. 
	
	\imagen{React/accessory_perforation}{Diagrama de la perforación de accesorios}{0.8}

	Para esto, lo que se hace es envolver al árbol de componentes de un componente Proveedor (figura \ref{fig:React/provider_pattern}), que va a ser el que va a almacenar los valores que queremos que estén disponibles. 
	
	\imagen{React/provider_pattern}{Diagrama del patrón Proveedor en React}{0.8}
	
	En caso de este proyecto esto se utiliza para almacenar la información referente al usuario que ha iniciado sesión.
\end{itemize}